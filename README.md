# سیستم رصد کانال‌های تلگرام (Theleton)

سیستم کامل برای رصد و ثبت آمار کانال‌های تلگرام با استفاده از Telethon و ربات مدیریتی.

## ویژگی‌ها

- ✅ رصد خودکار کانال‌های تلگرام هر 30 دقیقه
- ✅ ثبت آمار شامل: تعداد اعضا، بازدیدها، تغییرات
- ✅ ربات مدیریتی برای افزودن/حذف کانال‌ها
- ✅ نمایش آمار در ربات
- ✅ خروجی اکسل با فرمت مورد نظر

## نصب

1. نصب وابستگی‌ها:
```bash
pip install -r requirements.txt
```

2. دریافت API ID و API Hash:
   - به [my.telegram.org](https://my.telegram.org) بروید
   - وارد حساب خود شوید
   - به بخش API development tools بروید
   - API ID و API Hash را کپی کنید

3. دریافت توکن ربات مدیریتی:
   - با [@BotFather](https://t.me/BotFather) صحبت کنید
   - ربات جدید بسازید (`/newbot`)
   - توکن را کپی کنید

## تنظیمات

### 1. تنظیم ربات Telethon (رصد کانال‌ها)

فایل `config.json` را ویرایش کنید:
```json
{
  "api_id": "YOUR_API_ID",
  "api_hash": "YOUR_API_HASH"
}
```

یا هنگام اولین اجرا، اطلاعات را وارد کنید.

### 2. تنظیم ربات مدیریتی

فایل `admin_config.json` را ویرایش کنید:
```json
{
  "bot_token": "YOUR_BOT_TOKEN"
}
```

یا هنگام اولین اجرا، توکن را وارد کنید.

## اجرا

### ربات رصد کانال‌ها (Telethon)

این ربات باید همیشه در حال اجرا باشد:

```bash
python channel_monitor.py
```

در اولین اجرا:
1. API ID و API Hash را وارد کنید
2. شماره تلفن و کد را وارد کنید
3. ربات شروع به رصد کانال‌ها می‌کند

### ربات مدیریتی

در یک ترمینال جداگانه:

```bash
python admin_bot.py
```

در اولین اجرا:
1. توکن ربات را وارد کنید
2. ربات آماده استفاده است

## دستورات ربات مدیریتی

- `/start` - شروع ربات
- `/channels` - لیست کانال‌های فعال
- `/add <username>` - افزودن کانال جدید (مثال: `/add channel_name`)
- `/remove <username>` - حذف کانال (مثال: `/remove channel_name`)
- `/stats` - نمایش آمار کانال‌ها
- `/export` - دریافت فایل اکسل با آمار

## ساختار دیتابیس

دیتابیس SQLite به صورت خودکار در فایل `theleton.db` ایجاد می‌شود.

### جداول:

1. **channels** - اطلاعات کانال‌ها
   - id, username, title, added_by, added_at, is_active

2. **channel_stats** - تاریخچه آمار
   - id, channel_id, recorded_at, member_count, views_count, posts_count
   - member_change, views_change, posts_change, positive_change

3. **admins** - لیست ادمین‌ها
   - id, user_id, username, added_at

## نمونه خروجی اکسل

خروجی اکسل شامل ستون‌های زیر است:
- Title (عنوان کانال)
- Username Date (یوزرنیم و تاریخ)
- Member C (تعداد اعضا)
- Change fr (تغییرات اعضا)
- Change fr (تغییرات بازدید)
- Positive Change (تغییر مثبت/منفی)

## نکات مهم

- ربات رصد باید همیشه در حال اجرا باشد تا آمار به‌روز ثبت شود
- اولین کاربری که `/start` را اجرا کند، به عنوان ادمین اضافه می‌شود
- رصد کانال‌ها هر 30 دقیقه انجام می‌شود
- فایل سشن Telethon در `monitor_session.session` ذخیره می‌شود

## عیب‌یابی

- اگر خطای اتصال دریافت کردید، فایل `.session` را حذف کنید و دوباره احراز هویت کنید
- مطمئن شوید که به کانال‌ها دسترسی دارید (عضویت یا عضویت مجاز)
- بررسی کنید که API ID و API Hash درست باشند

## مجوز

این پروژه برای استفاده شخصی و تجاری آزاد است.
